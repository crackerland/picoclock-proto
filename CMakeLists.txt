cmake_minimum_required(VERSION 3.12)
include(pico_sdk_import.cmake)
set(PICO_BOARD="waveshare_rp2040_lcd_1.28")
project(picoclock)
pico_sdk_init()

set(RPI_LIB ${CMAKE_CURRENT_SOURCE_DIR}/rpi-base/lib)
set(RPI_CORE ${CMAKE_CURRENT_SOURCE_DIR}/rpi-base/src/core)
set(RPI_PERIPHERALS ${CMAKE_CURRENT_SOURCE_DIR}/rpi-base/src/peripherals)
add_library(core 
  ${RPI_CORE}/src/Arrays.c
	${RPI_CORE}/src/MathHelper.c
	${RPI_CORE}/src/ByteHelper.c
	${RPI_CORE}/src/crc.c
	${RPI_CORE}/src/collections/LinkedList.c
	${RPI_CORE}/src/collections/IterableQueryable.c
	${RPI_CORE}/src/print_helper.c
	${RPI_CORE}/src/Tasks.c)

include_directories(${RPI_CORE}/include)
include_directories(${RPI_PERIPHERALS}/include)

add_subdirectory(./lib/lcd)
include_directories(./lib/lcd)
add_subdirectory(./lib/QMI8658)
include_directories(./lib/QMI8658)
add_subdirectory(./lib/Battery)
include_directories(./lib/Battery/include)
add_subdirectory(./lib/Screen)
include_directories(./lib/Screen/include)

add_executable(main
  main.c
  lib/draw.c
)

# enable usb output, disable uart output
pico_enable_stdio_usb(main 1)
pico_enable_stdio_uart(main 1)

# create map/bin/hex/uf2 file etc.
pico_add_extra_outputs(main)

target_link_libraries(main
lcd QMI8658
pico_stdlib
hardware_spi
hardware_i2c
hardware_pwm
hardware_rtc
hardware_timer
hardware_adc
hardware_flash
hardware_sync
pico_bootsel_via_double_reset
core
battery
screen
)

add_custom_command(
        TARGET main POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy
                ${CMAKE_CURRENT_BINARY_DIR}/main.uf2
                ${CMAKE_CURRENT_BINARY_DIR}/../uf2/main.uf2
)
